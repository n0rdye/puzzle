<style>
    .object{
        background-color: #bfe4ff;
        border: dashed 4px transparent;
        border-radius: 4px;
        height: 50px;
        width: 50px;
        margin: 5px;
        margin-top: 0px;
    }
    img{
        width: 100%;
        height: 100%;
    }
    #objs_in_group{
        display: flex;
        flex-wrap: wrap;
    }
</style>

<h1>object edit</h1>
<div>
    <div id="objs_in_group"></div>
</div>
<div class="cmenu" id="object_menu">
    <button>del object</button>
    <button>change name</button>
    <button>change size</button>
</div>

<script>
    load_groups(()=>{
        edit_get_objs();
    });

    function edit_get_objs(){
        document.getElementById("objs_in_group").innerHTML = "";
        edit_load_objs((data)=>{
            data.forEach(value => {
                // console.log(value);
                // // console.log($.cookie("cache"));
                // console.log(localStorage.getItem(`${value["name"]}`));
                if ($.cookie("cache") == "true"){
                    if (localStorage.getItem(`${value["name"]}`) == null){
                        edit_load_obj(value["name"],"`img`",(odata)=>{
                            localStorage.setItem(value["name"],odata["img"]);
                            make(odata["img"]);
                        })
                    }
                    else{
                        make(localStorage.getItem(value["name"]))
                    }
                }
                else{
                    $.cookie("cache","true",{path:"/;SameSite=Strict"})
                    edit_load_obj(value["name"],"`img`",(odata)=>{
                        localStorage.setItem(value["name"],odata["img"]);
                        make(odata["img"]);
                    })
                } 
                function make(img){
                    let czones = document.getElementById("objs_in_group");
                    let czone =  document.createElement('div');
                    czone.classList.add(value["name"]);
                    czone.classList.add("object");
                    czone.innerHTML = `<img src="${img}">`
                    czones.append(czone)
                }              
            });
        })
    }

    function edit_load_obj(name,key,callback){
        $.post( "/get_obj",{name:name,key:key})
        .done(function( res ) {
            if(res["out"] == "good"){
                // console.log(res["body"]);
                callback(res["body"]);
            }
        });
    }
        
    function edit_load_objs(callback){
        let select = document.getElementById("group_select");
        $.post( "/get_objs",{gid:select.options[select.selectedIndex].getAttribute("gid")})
        .done(function( res ) {
            if(res["out"] == "good"){
                // console.log(res["body"]);
                // res["body"].forEach(object => {
                //     // objs_store[`${element["name"]}`] = {description:element["description"],height:element["height"],width:element["width"],id:element["id"],name:element["name"]}
                //     let obj_main = document.createElement("div");
                // });
                callback(res["body"]);
            }
        });
    }
</script>